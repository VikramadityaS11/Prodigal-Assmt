from groq import Groq

client = Groq()
completion = client.chat.completions.create(
    model="llama-3.3-70b-versatile",
    messages=[
      {
        "role": "user",
        "content": "You are an expert QA system for debt-collection call analysis.\nReturn STRICT JSON matching the schema below. Do not include markdown or extra text.\n\nSchema:\n{\n  \"payment_attempted\": boolean,\n  \"customer_intent\": boolean,\n  \"customer_sentiment\": {\n    \"classification\": \"Satisfied|Neutral|Frustrated|Hostile\",\n    \"description\": string\n  },\n  \"agent_performance\": string,\n  \"timestamped_events\": [\n    {\"timestamp\": \"m:ss\", \"event_type\": \"disclosure|offer_negotiation|payment_setup_attempt|frustration_hostility\", \"description\": string}\n  ]\n}\n\nGuidelines:\n- “Payment setup attempted” = the agent tries to take a payment (card/bank/portal), even if it fails.\n- “Customer intent” = TRUE only if the customer appears genuinely willing to pay.\n- Sentiment: choose ONE label; add a brief rationale (1–2 sentences).\n- Agent performance: 2–3 sentences evaluating clarity, patience, and helpfulness.\n- For events, extract key one-liners with approximate timestamps. If there's no timestamp, use \"unknown\".\n\n\nEvent extraction rules:\n- Only use these event_type values: disclosure, offer_negotiation, payment_setup_attempt, frustration_hostility.\n- disclosure = compliance statements (e.g., mini-Miranda, call-recording notice). Do NOT tag greetings or identity checks as disclosures.\n- offer_negotiation = any settlement/discount/plan terms, counters, or holds.\n- payment_setup_attempt = agent/customer provides or requests payment credentials (card/ACH/portal) or the system tries/validates and succeeds/fails.\n- frustration_hostility = explicit frustration, anger, accusations, or hostility from the consumer.\n- Do not invent other event types.\n- Maintain short descriptions, but if an offer_negotiation event has some numeric specifics, include that in description.\n\n\nTranscript:\n<<<BEGIN_TRANSCRIPT>>>\n[\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 0,\n    \"utterance\": \"Thank you for calling Recovery Services Inc. I'm Daniel, a virtual agent. How can I assist you?\",\n    \"etime\": 8\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 8,\n    \"utterance\": \"I want to pay off my account.\",\n    \"etime\": 11\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 11,\n    \"utterance\": \"I can help you with that. May I have your phone number?\",\n    \"etime\": 15\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 15,\n    \"utterance\": \"Nine seven three eight eight eight one two three four.\",\n    \"etime\": 21\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 21,\n    \"utterance\": \"Thank you. Confirming nine seven three eight eight eight one two three four?\",\n    \"etime\": 27\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 27,\n    \"utterance\": \"Yes.\",\n    \"etime\": 28\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 28,\n    \"utterance\": \"And your full name?\",\n    \"etime\": 30\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 30,\n    \"utterance\": \"James Anderson.\",\n    \"etime\": 33\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 33,\n    \"utterance\": \"Your date of birth?\",\n    \"etime\": 35\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 35,\n    \"utterance\": \"December twenty fifth nineteen seventy seven.\",\n    \"etime\": 41\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 41,\n    \"utterance\": \"Thank you, James. This is an attempt to collect a debt. Your current balance is eight hundred forty three dollars and fifty cents. Can you pay this today?\",\n    \"etime\": 52\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 52,\n    \"utterance\": \"Yes, I have my card ready. What's this debt for, though?\",\n    \"etime\": 57\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 57,\n    \"utterance\": \"This is from a personal loan account with QuickCash Lending that defaulted in February of twenty twenty five. Does that sound familiar?\",\n    \"etime\": 67\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 67,\n    \"utterance\": \"Oh yeah, the payday loan. I forgot about that.\",\n    \"etime\": 71\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 71,\n    \"utterance\": \"Yes, it's been several months now, and interest has accrued, which is why the balance is higher than the original loan amount.\",\n    \"etime\": 80\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 80,\n    \"utterance\": \"How much was the original loan?\",\n    \"etime\": 83\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 83,\n    \"utterance\": \"The original loan was five hundred dollars. With interest and fees, it's now eight hundred forty three dollars and fifty cents.\",\n    \"etime\": 91\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 91,\n    \"utterance\": \"Wow, that's almost double. Can you waive some of those fees?\",\n    \"etime\": 96\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 96,\n    \"utterance\": \"Let me check what I can do. For immediate payment today, I can reduce the balance to seven hundred fifty dollars even. That would save you almost a hundred dollars. Would that work for you?\",\n    \"etime\": 110\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 110,\n    \"utterance\": \"I guess that's better than nothing.\",\n    \"etime\": 114\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 114,\n    \"utterance\": \"It's a significant savings. Would you like to proceed with the payment of seven hundred fifty dollars?\",\n    \"etime\": 121\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 121,\n    \"utterance\": \"Yeah, let's do it.\",\n    \"etime\": 123\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 123,\n    \"utterance\": \"Great. We accept Visa and Mastercard. What's your card number?\",\n    \"etime\": 128\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 128,\n    \"utterance\": \"Four nine two seven six five four three two one zero.\",\n    \"etime\": 136\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 136,\n    \"utterance\": \"Thank you. Let me verify that. Can you repeat the card number for me?\",\n    \"etime\": 141\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 141,\n    \"utterance\": \"Four nine two seven six five four three two one zero.\",\n    \"etime\": 148\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 148,\n    \"utterance\": \"I'm sorry, that appears to be only eleven digits. Credit card numbers must be between twelve and sixteen digits. Can you verify the complete number?\",\n    \"etime\": 159\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 159,\n    \"utterance\": \"That's all the numbers on my card. Let me look again.\",\n    \"etime\": 164\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 164,\n    \"utterance\": \"Take your time. Sometimes the numbers can be worn off or hard to read.\",\n    \"etime\": 170\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 170,\n    \"utterance\": \"No, I'm looking at it right now. There's only eleven digits. It's an older card.\",\n    \"etime\": 176\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 176,\n    \"utterance\": \"I understand, but unfortunately our system requires a valid card number between twelve and sixteen digits to process the payment. The card number you provided is too short. Do you have another card you could use?\",\n    \"etime\": 190\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 190,\n    \"utterance\": \"No, that's my only card right now. Why won't it work? I've used this card before.\",\n    \"etime\": 197\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 197,\n    \"utterance\": \"Eleven digit card numbers aren't standard for Visa or Mastercard. It's possible there's a printing error on your card, or some digits have worn off over time. I recommend contacting your card issuer to verify the correct number.\",\n    \"etime\": 213\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 213,\n    \"utterance\": \"This is frustrating. I'm trying to pay and you're telling me I can't.\",\n    \"etime\": 218\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 218,\n    \"utterance\": \"I completely understand your frustration, James. We definitely want to accept your payment. The issue is that our payment system has security requirements, and it won't accept a card number that doesn't meet standard credit card formats.\",\n    \"etime\": 233\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 233,\n    \"utterance\": \"So what am I supposed to do?\",\n    \"etime\": 236\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 236,\n    \"utterance\": \"You have a few options. You could contact your bank to verify the correct card number or request a replacement card. Alternatively, if you have a checking account, we could explore setting up an ACH payment, though that would take a few business days to process.\",\n    \"etime\": 253\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 253,\n    \"utterance\": \"I don't want to wait days. I wanted to take care of this today.\",\n    \"etime\": 258\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 258,\n    \"utterance\": \"I understand. Unfortunately, without a valid card number, we can't process an immediate payment. However, I can hold the settlement offer of seven hundred fifty dollars for you for one week while you get this sorted out. Would that help?\",\n    \"etime\": 273\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 273,\n    \"utterance\": \"I guess so. So I have a week to get a new card?\",\n    \"etime\": 278\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 278,\n    \"utterance\": \"Yes, exactly. The seven hundred fifty dollar settlement will be valid for seven days. After that, the balance would revert to the full eight hundred forty three dollars and fifty cents.\",\n    \"etime\": 289\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 289,\n    \"utterance\": \"Okay. And when I call back, I just mention this offer?\",\n    \"etime\": 293\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 293,\n    \"utterance\": \"Yes, when you call back, let them know you spoke with Daniel about a settlement offer on your QuickCash Lending account. They'll be able to see the notes on your account.\",\n    \"etime\": 304\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 304,\n    \"utterance\": \"Alright. This is annoying, but I'll figure it out.\",\n    \"etime\": 309\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 309,\n    \"utterance\": \"I appreciate your patience, James. Is there anything else I can help you with today while we're on the line?\",\n    \"etime\": 316\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 316,\n    \"utterance\": \"No, I just need to deal with this card issue.\",\n    \"etime\": 320\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 320,\n    \"utterance\": \"Understood. Once you have a valid card number, please call us back at this same number. We're here Monday through Friday, eight AM to eight PM, and Saturdays nine AM to five PM.\",\n    \"etime\": 332\n  },\n  {\n    \"role\": \"User\",\n    \"stime\": 332,\n    \"utterance\": \"Okay, got it. Thanks.\",\n    \"etime\": 334\n  },\n  {\n    \"role\": \"Assistant\",\n    \"stime\": 334,\n    \"utterance\": \"You're welcome. Good luck with getting your card situation resolved, James. We'll talk to you soon.\",\n    \"etime\": 339\n  }\n]\n<<<END_TRANSCRIPT>>>\n"
      },
      {
        "role": "assistant",
        "content": "{\n  \"payment_attempted\": true,\n  \"customer_intent\": true,\n  \"customer_sentiment\": {\n    \"classification\": \"Frustrated\",\n    \"description\": \"The customer is frustrated due to the inability to make a payment with their current card and the inconvenience it causes.\"\n  },\n  \"agent_performance\": \"The agent is patient, clear, and helpful, providing explanations for the issues with the customer's card and offering alternative solutions. The agent also shows empathy towards the customer's frustration and provides a settlement offer to facilitate the payment process.\",\n  \"timestamped_events\": [\n    {\n      \"timestamp\": \"0:41\",\n      \"event_type\": \"disclosure\",\n      \"description\": \"The agent discloses that the call is an attempt to collect a debt and informs the customer about their current balance.\"\n    },\n    {\n      \"timestamp\": \"0:96\",\n      \"event_type\": \"offer_negotiation\",\n      \"description\": \"The customer requests a fee waiver, and the agent offers a settlement to reduce the balance.\"\n    },\n    {\n      \"timestamp\": \"1:23\",\n      \"event_type\": \"payment_setup_attempt\",\n      \"description\": \"The agent attempts to set up a payment with the customer's card.\"\n    },\n    {\n      \"timestamp\": \"2:13\",\n      \"event_type\": \"frustration_hostility\",\n      \"description\": \"The customer expresses frustration due to the issues with their card and the inability to make a payment.\"\n    },\n    {\n      \"timestamp\": \"2:33\",\n      \"event_type\": \"offer_negotiation\",\n      \"description\": \"The agent offers to hold the settlement offer for a week to allow the customer to resolve their card issue.\"\n    }\n  ]\n}"
      },
      {
        "role": "user",
        "content": ""
      },
      {
        "role": "assistant",
        "content": "{\n  \"payment_attempted\": true,\n  \"customer_intent\": true,\n  \"customer_sentiment\": {\n    \"classification\": \"Frustrated\",\n    \"description\": \"The customer is frustrated due to the inability to make a payment with their current card and the inconvenience it causes, but remains willing to pay.\"\n  },\n  \"agent_performance\": \"The agent is patient, clear, and helpful, providing explanations for the issues with the customer's card and offering alternative solutions. The agent also shows empathy towards the customer's frustration, providing a settlement offer to facilitate the payment process. The agent maintains a professional tone throughout the conversation, guiding the customer through the available options.\",\n  \"timestamped_events\": [\n    {\n      \"timestamp\": \"0:41\",\n      \"event_type\": \"disclosure\",\n      \"description\": \"The agent discloses that the call is an attempt to collect a debt and informs the customer about their current balance of $843.50.\"\n    },\n    {\n      \"timestamp\": \"1:36\",\n      \"event_type\": \"offer_negotiation\",\n      \"description\": \"The customer asks about waiving fees, and the agent offers to reduce the balance to $750 for immediate payment.\"\n    },\n    {\n      \"timestamp\": \"2:08\",\n      \"event_type\": \"payment_setup_attempt\",\n      \"description\": \"The agent attempts to set up a payment with the customer's card, but encounters an issue with the card number being too short.\"\n    },\n    {\n      \"timestamp\": \"2:13\",\n      \"event_type\": \"frustration_hostility\",\n      \"description\": \"The customer expresses frustration due to the issues with their card and the inability to make a payment.\"\n    },\n    {\n      \"timestamp\": \"2:33\",\n      \"event_type\": \"offer_negotiation\",\n      \"description\": \"The agent offers to hold the $750 settlement offer for a week to allow the customer to resolve their card issue.\"\n    }\n  ]\n}"
      },
      {
        "role": "user",
        "content": ""
      },
      {
        "role": "assistant",
        "content": "{\n  \"payment_attempted\": true,\n  \"customer_intent\": true,\n  \"customer_sentiment\": {\n    \"classification\": \"Frustrated\",\n    \"description\": \"The customer is frustrated due to the inability to make a payment with their current card and the inconvenience it causes, but remains willing to pay, indicated by phrases like 'I want to pay off my account' and 'I'm trying to pay'.\"\n  },\n  \"agent_performance\": \"The agent is patient, providing explanations for the issues with the customer's card and offering alternative solutions. The agent is clear in their communication, ensuring the customer understands the process and the available options. The agent also demonstrates helpfulness by guiding the customer through the payment process and offering to hold the settlement offer to facilitate future payment.\",\n  \"timestamped_events\": [\n    {\n      \"timestamp\": \"0:41\",\n      \"event_type\": \"disclosure\",\n      \"description\": \"The agent informs the customer about their current balance of $843.50 and the reason for the call.\"\n    },\n    {\n      \"timestamp\": \"1:36\",\n      \"event_type\": \"offer_negotiation\",\n      \"description\": \"The customer requests a fee waiver, and the agent offers to reduce the balance to $750 for immediate payment, saving the customer nearly $100.\"\n    },\n    {\n      \"timestamp\": \"2:08\",\n      \"event_type\": \"payment_setup_attempt\",\n      \"description\": \"The agent attempts to set up a payment with the customer's card but encounters an issue with the card number being too short to process the payment.\"\n    },\n    {\n      \"timestamp\": \"2:18\",\n      \"event_type\": \"frustration_hostility\",\n      \"description\": \"The customer expresses frustration, stating 'This is frustrating. I'm trying to pay and you're telling me I can't'.\"\n    },\n    {\n      \"timestamp\": \"2:33\",\n      \"event_type\": \"offer_negotiation\",\n      \"description\": \"The agent offers to hold the $750 settlement for one week, allowing the customer time to resolve their card issue and make the payment at the reduced amount.\"\n    }\n  ]\n}"
      },
      {
        "role": "user",
        "content": ""
      }
    ],
    temperature=1,
    max_completion_tokens=1024,
    top_p=1,
    stream=True,
    stop=None
)

for chunk in completion:
    print(chunk.choices[0].delta.content or "", end="")
